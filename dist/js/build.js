"use strict";var _createClass=function(){function t(t,s){for(var e=0;e<s.length;e++){var i=s[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(s,e,i){return e&&t(s.prototype,e),i&&t(s,i),s}}();function _classCallCheck(t,s){if(!(t instanceof s))throw new TypeError("Cannot call a class as a function")}var ClipBox=function(){function t(s,e,i){_classCallCheck(this,t),this.pos=s,this.size=e,this.offset=i}return _createClass(t,[{key:"overlaps",value:function(t){return this.bottom>t.top&&this.top<t.bottom&&this.left<t.right&&this.right>t.left}},{key:"bottom",get:function(){return this.pos.y+this.size.y+this.offset.y},set:function(t){this.pos.y=t-(this.size.y+this.offset.y)}},{key:"top",get:function(){return this.pos.y+this.offset.y},set:function(t){this.pos.y=t-this.offset.y}},{key:"left",get:function(){return this.pos.x+this.offset.x},set:function(t){this.pos.x=t-this.offset.x}},{key:"right",get:function(){return this.pos.x+this.size.x+this.offset.x},set:function(t){this.pos.x=t-(this.size.x+this.offset.x)}}]),t}();
"use strict";function _classCallCheck(s,a){if(!(s instanceof a))throw new TypeError("Cannot call a class as a function")}var Camera=function s(){_classCallCheck(this,s),this.pos=new Vec2(0,0),this.size=new Vec2(840,660)};
"use strict";var _createClass=function(){function e(e,n){for(var r=0;r<n.length;r++){var a=n[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(n,r,a){return r&&e(n.prototype,r),a&&e(n,a),n}}();function _classCallCheck(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}var Compositor=function(){function e(){_classCallCheck(this,e),this.layers=[]}return _createClass(e,[{key:"draw",value:function(e,n){this.layers.forEach(function(r){r(e,n)})}}]),e}();
"use strict";var _createClass=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}();function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var Sides={TOP:Symbol("top"),BOTTOM:Symbol("bottom"),LEFT:Symbol("left"),RIGHT:Symbol("right")},Trait=function(){function t(e){_classCallCheck(this,t),this.NAME=e,this.tasks=[]}return _createClass(t,[{key:"finalize",value:function(){this.tasks.forEach(function(t){return t()}),this.tasks.length=0}},{key:"queue",value:function(t){this.tasks.push(t)}},{key:"collides",value:function(t,e){}},{key:"obstruct",value:function(){}},{key:"update",value:function(){}}]),t}(),Entity=function(){function t(e){_classCallCheck(this,t),this.name=e,this.pos=new Vec2(0,0),this.vel=new Vec2(0,0),this.size=new Vec2(0,0),this.offset=new Vec2(0,0),this.bounds=new ClipBox(this.pos,this.size,this.offset),this.lifetime=0,this.traits=[]}return _createClass(t,[{key:"addTrait",value:function(t){this.traits.push(t),this[t.NAME]=t}},{key:"collides",value:function(t){var e=this;this.traits.forEach(function(i){i.collides(e,t)})}},{key:"obstruct",value:function(t,e){var i=this;this.traits.forEach(function(n){n.obstruct(i,t,e)})}},{key:"draw",value:function(){}},{key:"finalize",value:function(){this.traits.forEach(function(t){t.finalize()})}},{key:"update",value:function(t,e){var i=this;this.traits.forEach(function(n){n.update(i,t,e)}),this.lifetime+=t}}]),t}();
"use strict";var _createClass=function(){function e(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(n,t,r){return t&&e(n.prototype,t),r&&e(n,r),n}}();function _classCallCheck(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}var EntityCollider=function(){function e(n){_classCallCheck(this,e),this.entities=n}return _createClass(e,[{key:"check",value:function(e){this.entities.forEach(function(n){e!==n&&e.bounds.overlaps(n.bounds)&&(e.collides(n),n.collides(e))})}}]),e}();
"use strict";var _createClass=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}();function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var Level=function(){function t(e,i,n){_classCallCheck(this,t),this.name=e,this.gravity=1500,this.totalTime=0,this.comp=new Compositor,this.entities=new Set,this.entityCollider=new EntityCollider(this.entities),this.tileCollider=null,this.levelEnd=n,this.maxScore=i}return _createClass(t,[{key:"setCollisionGrid",value:function(t){this.tileCollider=new TileCollider(t)}},{key:"update",value:function(t){var e=this;this.entities.forEach(function(i){i.update(t,e)}),this.entities.forEach(function(t){e.entityCollider.check(t)}),this.entities.forEach(function(t){t.finalize()}),this.totalTime+=t}}]),t}();
"use strict";var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var l=t[n];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(e,l.key,l)}}return function(t,n,l){return n&&e(t.prototype,n),l&&e(t,l),t}}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var PlayerController=function(e){function t(){_classCallCheck(this,t);var e=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"playerController"));return e.checkpoint=new Vec2(0,0),e.player=null,e.score=0,e.scoreSelector=document.getElementById("unicorn-score"),e.armorSelector=document.getElementById("armor-score"),e.flySelector=document.getElementById("fly-score"),e}return _inherits(t,Trait),_createClass(t,[{key:"setPlayer",value:function(e){var t=this;this.player=e,this.armorSelector.innerHTML=this.player.armor.getCount(),this.player.picker.onPick=function(){t.score+=50,setTimeout(function(){t.scoreSelector.innerHTML=t.score},0)},this.player.armor.onChangeArmor=function(){t.armorSelector.innerHTML=t.player.armor.getCount()},this.player.fly.onChangeFlyingSec=function(){t.flySelector.innerHTML=t.player.fly.getSeconds().toFixed(1)+" s"}}},{key:"cleanScore",value:function(){var e=this;this.score=0,setTimeout(function(){e.scoreSelector.innerHTML=e.score},0)}},{key:"setScore",value:function(e){var t=this;this.score=e,setTimeout(function(){t.scoreSelector.innerHTML=t.score},0)}},{key:"update",value:function(e,t,n){n.entities.has(this.player)||(this.player.killable.revive(),this.player.pos.set(this.checkpoint.x,this.checkpoint.y),n.entities.add(this.player)),this.player.pos.y>1200&&(this.player.killable.revive(),this.player.pos.set(this.checkpoint.x,this.checkpoint.y),n.entities.add(this.player)),this.player.pos.x>n.levelEnd&&(STATE="completed",document.getElementById("level-completed-wrapper").classList.add("show"),renderLevelCompleteBlock(n.name,this.score,n.maxScore),document.getElementById("screen").classList.add("fade-in"),this.player.killable.revive(),this.player.pos.set(this.checkpoint.x,this.checkpoint.y),n.entities.add(this.player))}}]),t}();function renderLevelCompleteBlock(e,t,n){var l=0;t>0&&l++;var r=100*Math.round(n/3/100);1===l&&t>=r&&l++,2===l&&t>=2*r&&l++,clearLevelCompleteBlock();var o=document.getElementById("level-completed-wrapper"),c=LEVELS_ORDER.indexOf(e),i=document.createElement("p");i.setAttribute("class","level-completed-title"),i.innerText="Level Completed";var a=document.createElement("div");a.setAttribute("class","level-completed-stars"),a.innerHTML='\n        <span class="star-five '+(l>0?"filled":"")+'"></span>\n        <span class="star-five '+(l>1?"filled":"")+'"></span>\n        <span class="star-five '+(l>2?"filled":"")+'"></span>\n    ';var s=document.createElement("div");s.setAttribute("class","level-completed-score"),s.innerHTML='\n        <div class="level-completed-score-title">Score</div>\n        <div class="level-completed-score-value">'+t+"</div>\n    ";var p=document.createElement("div");p.setAttribute("class","level-completed-actions");var d=document.createElement("div"),u=document.createElement("i");u.setAttribute("class","fa fa-list"),d.appendChild(u),d.addEventListener("click",function(){clearLevelCompleteBlock(),document.getElementById("level-select-wrapper").classList.add("show"),STATE="levelSelecting"});var m=document.createElement("div"),h=document.createElement("i");h.setAttribute("class","fa fa-refresh"),m.appendChild(h),m.addEventListener("click",function(){clearLevelCompleteBlock(),main(CANVAS,LEVELS[e])});var v=document.createElement("div"),f=document.createElement("i");f.setAttribute("class","fa fa-play"),v.appendChild(f),v.addEventListener("click",function(){c+1<=LEVELS_ORDER.length-1&&(clearLevelCompleteBlock(),main(CANVAS,LEVELS[LEVELS_ORDER[c+1]]))}),p.appendChild(d),p.appendChild(m),c+1<=LEVELS_ORDER.length-1&&p.appendChild(v),o.appendChild(i),o.appendChild(a),o.appendChild(s),o.appendChild(p)}function clearLevelCompleteBlock(){for(var e=document.getElementById("level-completed-wrapper"),t=e.childNodes,n=t.length;n>0;n--)e.removeChild(t[n-1]);document.getElementById("screen").classList.remove("fade-in")}
"use strict";var _createClass=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var SpriteSheet=function(){function e(t,i,n){_classCallCheck(this,e),this.image=t,this.width=i,this.height=n,this.tiles=new Map,this.animations=new Map}return _createClass(e,[{key:"defineAnim",value:function(e,t){this.animations.set(e,t)}},{key:"define",value:function(e,t,i,n,a){var r=this,s=[!1,!0].map(function(){var e=document.createElement("canvas");return e.width=n,e.height=a,e.getContext("2d").drawImage(r.image,t,i,n,a,0,0,n,a),e});this.tiles.set(e,s)}},{key:"draw",value:function(e,t,i,n){var a=this.tiles.get(e)[0];t.drawImage(a,i,n)}},{key:"drawTile",value:function(e,t,i,n){this.draw(e,t,i*this.width,n*this.height)}}]),e}();
"use strict";var _createClass=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var TileResolver=function(){function e(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:60;_classCallCheck(this,e),this.matrix=t,this.tileSize=i}return _createClass(e,[{key:"toIndex",value:function(e){return Math.floor(e/this.tileSize)}},{key:"toIndexRange",value:function(e,t){for(var i=Math.ceil(t/this.tileSize)*this.tileSize,n=[],o=e;n.push(this.toIndex(o)),(o+=this.tileSize)<i;);return n}},{key:"getByIndex",value:function(e,t){var i=this.matrix.get(e,t);if(i){var n=e*this.tileSize,o=n+this.tileSize,s=t*this.tileSize;return{tile:i,x1:n,x2:o,y1:s,y2:s+this.tileSize}}}},{key:"searchByPosition",value:function(e,t){return this.getByIndex(this.toIndex(e),this.toIndex(t))}},{key:"searchByRange",value:function(e,t,i,n){var o=this,s=[];return this.toIndexRange(e,t).forEach(function(e){o.toIndexRange(i,n).forEach(function(t){var i=o.getByIndex(e,t);i&&s.push(i)})}),s}}]),e}(),TileCollider=function(){function e(t){_classCallCheck(this,e),this.tiles=new TileResolver(t)}return _createClass(e,[{key:"checkX",value:function(e){var t=void 0;if(e.vel.x>0)t=e.bounds.right;else{if(!(e.vel.x<0))return;t=e.bounds.left}this.tiles.searchByRange(t,t,e.bounds.top,e.bounds.bottom).forEach(function(t){e.vel.x>0?e.bounds.right>t.x1&&e.obstruct(Sides.RIGHT,t):e.vel.x<0&&e.bounds.left<t.x2&&e.obstruct(Sides.LEFT,t)})}},{key:"checkY",value:function(e){var t=void 0;if(e.vel.y>0)t=e.bounds.bottom;else{if(!(e.vel.y<0))return;t=e.bounds.top}this.tiles.searchByRange(e.bounds.left,e.bounds.right,t,t).forEach(function(t){e.vel.y>0?e.bounds.bottom>t.y1&&e.obstruct(Sides.BOTTOM,t):e.vel.y<0&&e.bounds.top<t.y2&&e.obstruct(Sides.TOP,t)})}}]),e}();
"use strict";var _createClass=function(){function e(e,n){for(var t=0;t<n.length;t++){var a=n[t];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(n,t,a){return t&&e(n.prototype,t),a&&e(n,a),n}}();function _classCallCheck(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}var Timer=function(){function e(){var n=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1/60;_classCallCheck(this,e);var a=0,r=0;this.updateProxy=function(e){for((a+=(e-r)/1e3)>1&&(a=1);a>t;)"game"===STATE&&n.update(t),a-=t;r=e,n.enqueue()}}return _createClass(e,[{key:"enqueue",value:function(){requestAnimationFrame(this.updateProxy)}},{key:"start",value:function(){this.enqueue()}}]),e}();
"use strict";var _createClass=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var Physics=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"physics"))}return _inherits(t,Trait),_createClass(t,[{key:"update",value:function(e,t,i){e.pos.x+=e.vel.x*t,i.tileCollider.checkX(e),e.pos.y+=e.vel.y*t,i.tileCollider.checkY(e),e.vel.y+=i.gravity*t}}]),t}(),Solid=function(e){function t(){_classCallCheck(this,t);var e=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"solid"));return e.obstructs=!0,e}return _inherits(t,Trait),_createClass(t,[{key:"obstruct",value:function(e,t,i){this.obstructs&&(t===Sides.BOTTOM?(e.bounds.bottom=i.y1,e.vel.y=0):t===Sides.TOP?(e.bounds.top=i.y2,e.vel.y=0):t===Sides.LEFT?(e.bounds.left=i.x2,e.vel.x=0):t===Sides.RIGHT&&(e.bounds.right=i.x1,e.vel.x=0))}}]),t}(),Run=function(e){function t(){_classCallCheck(this,t);var e=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"run"));return e.speed=13e3,e.distance=0,e}return _inherits(t,Trait),_createClass(t,[{key:"update",value:function(e,t){e.vel.x=this.speed*t,this.distance+=Math.abs(e.vel.x)*t}}]),t}(),Armor=function(e){function t(){_classCallCheck(this,t);var e=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"armor")),i=1,n=e;return e.collided=!1,e.incrementCount=function(e){e?i+=e:i++,this.onChangeArmor()},e.decrementCount=function(){i--,this.onChangeArmor(),this.collided=!0,setTimeout(function(){n.collided=!1},3e3)},e.getCount=function(){return i},e}return _inherits(t,Trait),t}(),Jump=function(e){function t(){_classCallCheck(this,t);var e=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"jump"));return e.ready=0,e.duration=.8,e.engageTime=0,e.requestTime=0,e.gracePeriod=.1,e.speedBoost=.3,e.velocity=200,e}return _inherits(t,Trait),_createClass(t,[{key:"start",value:function(){this.requestTime=this.gracePeriod}},{key:"cancel",value:function(){this.engageTime=0,this.requestTime=0}},{key:"obstruct",value:function(e,t){t===Sides.BOTTOM?this.ready=1:t===Sides.TOP&&this.cancel()}},{key:"update",value:function(e,t){this.requestTime>0&&(this.ready>0&&(this.engageTime=this.duration,this.requestTime=0),this.requestTime-=t),this.engageTime>0&&(e.vel.y=-(this.velocity+Math.abs(e.vel.x)*this.speedBoost),this.engageTime-=t),this.ready--}},{key:"falling",get:function(){return this.ready<0}}]),t}(),Fly=function(e){function t(){_classCallCheck(this,t);var e=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"fly"));e.active=!1,e.speedBoost=.3,e.velocity=200;var i=2;return e.addSeconds=function(e){i+=e,this.onChangeFlyingSec()},e.getSeconds=function(){return i},e}return _inherits(t,Trait),_createClass(t,[{key:"start",value:function(){this.active=!0}},{key:"cancel",value:function(){this.active=!1}},{key:"update",value:function(e,t){this.active&&(this.getSeconds()>0?(e.pos.y>50?e.vel.y=-(this.velocity+Math.abs(e.vel.x)*this.speedBoost):e.pos.y=50,this.addSeconds(-t)):this.addSeconds(-this.getSeconds()))}}]),t}(),Killable=function(e){function t(){_classCallCheck(this,t);var e=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"killable"));return e.dead=!1,e.deadTime=0,e.removeAfter=.3,e}return _inherits(t,Trait),_createClass(t,[{key:"kill",value:function(){var e=this;this.queue(function(){return e.dead=!0})}},{key:"revive",value:function(){this.dead=!1,this.deadTime=0}},{key:"update",value:function(e,t,i){this.dead&&(this.deadTime+=t,this.deadTime>this.removeAfter&&this.queue(function(){i.entities.delete(e)}))}}]),t}(),Pickable=function(e){function t(){_classCallCheck(this,t);var e=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"pickable"));return e.picked=!1,e.pickTime=0,e.removeAfter=.3,e}return _inherits(t,Trait),_createClass(t,[{key:"pick",value:function(){var e=this;this.queue(function(){return e.picked=!0})}},{key:"update",value:function(e,t,i){this.picked&&(this.pickTime+=t,this.pickTime>this.removeAfter&&this.queue(function(){i.entities.delete(e)}))}}]),t}(),Picker=function(e){function t(){_classCallCheck(this,t);var e=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"picker"));return e.onPick=function(){},e}return _inherits(t,Trait),_createClass(t,[{key:"collides",value:function(e,t){if(t.pickable&&!t.pickable.picked)switch(t.name){case"rainbow":this.onPick(e,t);break;case"rocket":e.fly.addSeconds(2.5);break;case"armor":e.armor.incrementCount(.5)}}}]),t}();
"use strict";var LEVELS={LEVEL1:{layers:[{tiles:[{ranges:[[0,1,3,4],[17,1,3,1],[1,19,6,1],[24,10,6,1],[38,10,4,1],[51,2,4,1],[55,2,6,1],[60,1,6,1],[64,5,8,1],[73,10,5,1],[87,3,8,1],[89,1,4,1],[93,4,6,1],[101,19,6,1],[124,10,6,1],[138,10,4,1],[151,2,4,1],[155,2,6,1],[160,1,6,1],[164,5,8,1],[173,10,5,1],[187,2,8,1],[193,1,6,1]]}]}],entities:[{name:"rainbow",pos:[408,0]},{name:"enemyBug",pos:[780,0]},{name:"rocket",pos:[1030,0]},{name:"rainbow",pos:[1608,0]},{name:"enemyBug",pos:[1800,0]},{name:"enemyBug",pos:[2580,0]},{name:"rainbow",pos:[3288,0]},{name:"enemyBug",pos:[3960,0]},{name:"rainbow",pos:[4448,0]},{name:"enemyBug",pos:[4620,0]},{name:"armor",pos:[5230,0]},{name:"rainbow",pos:[5588,0]},{name:"enemyBug",pos:[6170,0]},{name:"rainbow",pos:[7388,0]}],backgroundImage:"img/grass.png",previewImage:"img/grass-preview.png",backgroundColor:"#0714BC",frontImage:"img/glass_front.png",backImage:"img/glass_back.png",title:"Level 1",name:"LEVEL1",boardImage:"img/board_update.png",levelEnd:11400,maxScore:600},LEVEL2:{layers:[{tiles:[{ranges:[[0,1,3,4],[17,1,3,1],[1,19,6,1],[24,10,6,1],[38,10,4,1],[51,2,4,1],[55,2,6,1],[60,1,6,1],[64,5,8,1],[73,10,5,1],[87,3,8,1],[89,1,4,1],[93,4,6,1],[101,19,6,1],[124,10,6,1],[138,10,4,1],[151,2,4,1],[155,2,6,1],[160,1,6,1],[164,5,8,1],[173,10,5,1],[187,2,8,1],[193,1,6,1]]}]}],entities:[{name:"rainbow",pos:[408,0]},{name:"enemyBug",pos:[780,0]},{name:"rocket",pos:[1030,0]},{name:"rainbow",pos:[1608,0]},{name:"enemyBug",pos:[1800,0]},{name:"enemyBug",pos:[2580,0]},{name:"rainbow",pos:[3288,0]},{name:"enemyBug",pos:[3960,0]},{name:"rainbow",pos:[4448,0]},{name:"enemyBug",pos:[4620,0]},{name:"armor",pos:[5230,0]},{name:"rainbow",pos:[5588,0]},{name:"enemyBug",pos:[6170,0]},{name:"rainbow",pos:[7388,0]}],backgroundImage:"img/mountain-min.png",previewImage:"img/mountain-preview.png",backgroundColor:"#2892ce",frontImage:"",backImage:"",title:"Level 2",name:"LEVEL2",boardImage:"img/board_update.png",levelEnd:11400,maxScore:600},LEVEL3:{layers:[{tiles:[{ranges:[[0,1,3,4],[17,1,3,1],[1,19,6,1],[24,10,6,1],[38,10,4,1],[51,2,4,1],[55,2,6,1],[60,1,6,1],[64,5,8,1],[73,10,5,1],[87,3,8,1],[89,1,4,1],[93,4,6,1],[101,19,6,1],[124,10,6,1],[138,10,4,1],[151,2,4,1],[155,2,6,1],[160,1,6,1],[164,5,8,1],[173,10,5,1],[187,2,8,1],[193,1,6,1]]}]}],entities:[{name:"rainbow",pos:[408,0]},{name:"enemyBug",pos:[780,0]},{name:"rocket",pos:[1030,0]},{name:"rainbow",pos:[1608,0]},{name:"enemyBug",pos:[1800,0]},{name:"enemyBug",pos:[2580,0]},{name:"rainbow",pos:[3288,0]},{name:"enemyBug",pos:[3960,0]},{name:"rainbow",pos:[4448,0]},{name:"enemyBug",pos:[4620,0]},{name:"armor",pos:[5230,0]},{name:"rainbow",pos:[5588,0]},{name:"enemyBug",pos:[6170,0]},{name:"rainbow",pos:[7388,0]}],backgroundImage:"img/bridge-min.jpg",previewImage:"img/bridge-preview.png",backgroundColor:"#88c0e1",frontImage:"",backImage:"",title:"Level 3",name:"LEVEL3",boardImage:"img/board_update.png",levelEnd:11400,maxScore:600}},LEVELS_ORDER=["LEVEL1","LEVEL2","LEVEL3"],CANVAS=document.getElementById("screen");
"use strict";function createBackgroundLayer(e,t,n){var a=new TileResolver(t),o=document.createElement("canvas"),r=new SpriteSheet(n,60,60);r.define("ground",0,0,60,60),o.width=900,o.height=660;var i=o.getContext("2d");return function(e,n){var d=a.toIndex(n.size.x),c=a.toIndex(n.pos.x);!function(e,n){i.clearRect(0,0,o.width,o.height);for(var a=function(n){var a=t.grid[n];a&&a.forEach(function(t,a){r.drawTile("ground",i,n-e,a)})},d=e;d<=n;++d)a(d)}(c,c+d),e.drawImage(o,-n.pos.x%60,-n.pos.y)}}function drawStaticBackground(e){var t=document.createElement("canvas");t.width=900,t.height=660;var n=void 0,a=void 0,o=void 0,r=0;t.getContext("2d");return loadImage(e.backImage).then(function(e){a=e}),r++,loadImage(e.backgroundImage).then(function(e){n=e,r++}),loadImage(e.frontImage).then(function(e){o=e}),r++,function(i,d){var c,h,g;r>2&&(c=i,h=e.backgroundColor,(g=c.createLinearGradient(0,0,0,t.width)).addColorStop(0,h),g.addColorStop(1,h),c.fillStyle=g,c.fillRect(0,0,t.width,t.height),function(e,r){for(var i=-r.pos.x/.8,d=-r.pos.x/1.2,c=0;c<30;c++)a&&e.drawImage(a,d+n.width*c+600,t.height-a.height+1),e.drawImage(n,i+n.width*c,t.height-n.height+1),o&&e.drawImage(o,d+n.width*c+100,t.height-o.height+1)}(i,d))}}function createSpriteLayer(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:172,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:119,a=document.createElement("canvas");a.width=t,a.height=n;var o=a.getContext("2d");return function(r,i){e.forEach(function(e){o.clearRect(0,0,t,n),e.draw(o),r.drawImage(a,e.pos.x-i.pos.x,e.pos.y-i.pos.y)})}}
"use strict";var _slicedToArray=function(){return function(e,r){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,r){var t=[],n=!0,a=!1,i=void 0;try{for(var o,c=e[Symbol.iterator]();!(n=(o=c.next()).done)&&(t.push(o.value),!r||t.length!==r);n=!0);}catch(e){a=!0,i=e}finally{try{!n&&c.return&&c.return()}finally{if(a)throw i}}return t}(e,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),_marked=regeneratorRuntime.mark(expandSpan),_marked2=regeneratorRuntime.mark(expandRanges),_marked4=regeneratorRuntime.mark(expandTiles);function setupCollision(e,r){var t=createCollisionGrid(e.layers.reduce(function(e,r){return e.concat(r.tiles)},[]),e.patterns);r.setCollisionGrid(t)}function setupBackgrounds(e,r,t){e.layers.forEach(function(n){var a=createBackgroundGrid(n.tiles,e.patterns),i=createBackgroundLayer(r,a,t.image),o=drawStaticBackground(t);r.comp.layers.push(o),r.comp.layers.push(i)})}function setupEntities(e,r,t){e.entities.forEach(function(e){var n=e.name,a=_slicedToArray(e.pos,2),i=a[0],o=a[1],c=(0,t[n])();c.pos.set(i,o),r.entities.add(c)});var n=createSpriteLayer(r.entities);r.comp.layers.push(n)}function createLevelLoader(e){return function(r){return new Promise(function(e){e(r)}).then(function(e){return Promise.all([e,loadImage(r.boardImage)])}).then(function(t){var n=_slicedToArray(t,2),a=n[0],i=n[1],o=new Level(r.name,r.maxScore,r.levelEnd);return setupCollision(a,o),setupBackgrounds(a,o,{backgroundImage:r.backgroundImage,backgroundColor:r.backgroundColor,backImage:r.backImage,frontImage:r.frontImage,image:i}),setupEntities(a,o,e),o})}}function createCollisionGrid(e,r){var t=new Matrix,n=!0,a=!1,i=void 0;try{for(var o,c=expandTiles(e,r)[Symbol.iterator]();!(n=(o=c.next()).done);n=!0){var s=o.value,u=s.tile,l=s.x,d=s.y;t.set(l,d,{type:u.type})}}catch(e){a=!0,i=e}finally{try{!n&&c.return&&c.return()}finally{if(a)throw i}}return t}function createBackgroundGrid(e,r){var t=new Matrix,n=!0,a=!1,i=void 0;try{for(var o,c=expandTiles(e,r)[Symbol.iterator]();!(n=(o=c.next()).done);n=!0){var s=o.value,u=s.tile,l=s.x,d=s.y;t.set(l,d,{name:u.name})}}catch(e){a=!0,i=e}finally{try{!n&&c.return&&c.return()}finally{if(a)throw i}}return t}function expandSpan(e,r,t,n){var a,i,o,c;return regeneratorRuntime.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:a=e+r,i=t+n,o=e;case 3:if(!(o<a)){s.next=14;break}c=t;case 5:if(!(c<i)){s.next=11;break}return s.next=8,{x:o,y:c};case 8:++c,s.next=5;break;case 11:++o,s.next=3;break;case 14:case"end":return s.stop()}},_marked,this)}function expandRange(e){if(4===e.length){var r=_slicedToArray(e,4);return expandSpan(r[0],r[1],r[2],r[3])}if(3===e.length){var t=_slicedToArray(e,3);return expandSpan(t[0],t[1],t[2],1)}if(2===e.length){var n=_slicedToArray(e,2);return expandSpan(n[0],1,n[1],1)}}function expandRanges(e){var r,t,n,a,i,o;return regeneratorRuntime.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:r=!0,t=!1,n=void 0,c.prev=3,a=e[Symbol.iterator]();case 5:if(r=(i=a.next()).done){c.next=11;break}return o=i.value,c.delegateYield(expandRange(o),"t0",8);case 8:r=!0,c.next=5;break;case 11:c.next=17;break;case 13:c.prev=13,c.t1=c.catch(3),t=!0,n=c.t1;case 17:c.prev=17,c.prev=18,!r&&a.return&&a.return();case 20:if(c.prev=20,!t){c.next=23;break}throw n;case 23:return c.finish(20);case 24:return c.finish(17);case 25:case"end":return c.stop()}},_marked2,this,[[3,13,17,25],[18,,20,24]])}function expandTiles(e,r){var t,n;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return n=function e(n,a,i){var o,c,s,u,l,d,p,f,v,x,m,y,g,k,h,b,w;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:o=!0,c=!1,s=void 0,t.prev=3,u=n[Symbol.iterator]();case 5:if(o=(l=u.next()).done){t.next=45;break}d=l.value,p=!0,f=!1,v=void 0,t.prev=10,x=expandRanges(d.ranges)[Symbol.iterator]();case 12:if(p=(m=x.next()).done){t.next=28;break}if(y=m.value,g=y.x,k=y.y,h=g+a,b=k+i,!d.pattern){t.next=23;break}return w=r[d.pattern].tiles,t.delegateYield(e(w,h,b),"t0",21);case 21:t.next=25;break;case 23:return t.next=25,{tile:d,x:h,y:b};case 25:p=!0,t.next=12;break;case 28:t.next=34;break;case 30:t.prev=30,t.t1=t.catch(10),f=!0,v=t.t1;case 34:t.prev=34,t.prev=35,!p&&x.return&&x.return();case 37:if(t.prev=37,!f){t.next=40;break}throw v;case 40:return t.finish(37);case 41:return t.finish(34);case 42:o=!0,t.next=5;break;case 45:t.next=51;break;case 47:t.prev=47,t.t2=t.catch(3),c=!0,s=t.t2;case 51:t.prev=51,t.prev=52,!o&&u.return&&u.return();case 54:if(t.prev=54,!c){t.next=57;break}throw s;case 57:return t.finish(54);case 58:return t.finish(51);case 59:case"end":return t.stop()}},t,this,[[3,47,51,59],[10,30,34,42],[35,,37,41],[52,,54,58]])},t=regeneratorRuntime.mark(n),a.delegateYield(n(e,0,0),"t0",3);case 3:case"end":return a.stop()}},_marked4,this)}
"use strict";var _slicedToArray=function(){return function(r,n){if(Array.isArray(r))return r;if(Symbol.iterator in Object(r))return function(r,n){var e=[],t=!0,a=!1,i=void 0;try{for(var o,u=r[Symbol.iterator]();!(t=(o=u.next()).done)&&(e.push(o.value),!n||e.length!==n);t=!0);}catch(r){a=!0,i=r}finally{try{!t&&u.return&&u.return()}finally{if(a)throw i}}return e}(r,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();function _toConsumableArray(r){if(Array.isArray(r)){for(var n=0,e=Array(r.length);n<r.length;n++)e[n]=r[n];return e}return Array.from(r)}function createAnim(r,n){return function(e){var t=Math.floor(e/n)%r.length;return r[t]}}function loadImage(r){return new Promise(function(n){var e=new Image;e.addEventListener("load",function(){n(e)}),e.src=r})}function loadSpriteSheet(r){return new Promise(function(n){n(r)}).then(function(r){return Promise.all([r,loadImage(r.imageURL)])}).then(function(r){var n=_slicedToArray(r,2),e=n[0],t=n[1],a=new SpriteSheet(t,e.tileW,e.tileH);return e.frames&&e.frames.forEach(function(r){a.define.apply(a,[r.name].concat(_toConsumableArray(r.rect)))}),e.animations&&e.animations.forEach(function(r){var n=createAnim(r.frames,r.frameLen);a.defineAnim(r.name,n)}),a})}
"use strict";var main=function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(n,t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return STATE="game",context=n.getContext("2d"),e.next=4,loadChars();case 4:return charsFactory=e.sent,e.next=7,createLevelLoader(charsFactory);case 7:return loadLevel=e.sent,e.next=10,loadLevel(t);case 10:level=e.sent,camera=new Camera,unicorn=charsFactory.unicorn(),playerEnv=createPlayerEnv(unicorn),level.entities.add(playerEnv),timer||(timer=new Timer(1/60)),timer.update=function(e){level.update(e),camera.pos.x=Math.max(0,unicorn.pos.x-100),level.comp.draw(context,camera)},listenersIsAdded||(["keydown","keyup"].forEach(function(e){window.addEventListener(e,function(e){if("Space"===e.code&&"game"===STATE){("keydown"===e.type?1:0)>0?unicorn.jump.start():unicorn.jump.cancel()}else{if("KeyF"===e.code&&"game"===STATE)("keydown"===e.type?1:0)>0?unicorn.fly.start():unicorn.fly.cancel();"keyup"!==e.type||"KeyP"!==e.code||"game"!==STATE&&"pause"!==STATE||(STATE="pause"===STATE?"game":"pause",document.getElementById("menu-wrapper").classList["pause"===STATE?"add":"remove"]("show"),document.getElementById("screen").classList["pause"===STATE?"add":"remove"]("fade-in")),"keyup"===e.type&&"Escape"===e.code&&"bonus"===STATE&&(STATE="pause",document.getElementById("menu-wrapper").classList.add("show"),document.getElementById("buy-bonus-wrapper").classList.remove("show")),unicorn.jump.cancel()}})}),document.getElementById("menu").addEventListener("click",function(e){if("LI"===e.target.nodeName)switch(e.target.getAttribute("data-action")){case"continue":STATE="game",document.getElementById("menu-wrapper").classList.remove("show"),document.getElementById("screen").classList.remove("fade-in");break;case"changeLocation":STATE="levelSelecting",document.getElementById("level-select-wrapper").classList.add("show"),document.getElementById("menu-wrapper").classList.remove("show");break;case"bonus":STATE="bonus",document.getElementById("buy-bonus-wrapper").classList.add("show"),document.getElementById("menu-wrapper").classList.remove("show")}}),document.getElementById("bonus-menu").addEventListener("click",function(e){var n=findAncestor(e.target,"bonus-menu-item");if(n){switch(n.getAttribute("data-type")){case"armor":playerEnv.playerController.score>=200?(unicorn.armor.incrementCount(),playerEnv.playerController.setScore(playerEnv.playerController.score-200)):alert("Недостаточно средств");break;case"flying":playerEnv.playerController.score>=400?(unicorn.fly.addSeconds(5),unicorn.fly.onChangeFlyingSec(),playerEnv.playerController.setScore(playerEnv.playerController.score-400)):alert("Недостаточно средств")}STATE="pause",document.getElementById("menu-wrapper").classList.add("show"),document.getElementById("buy-bonus-wrapper").classList.remove("show")}}),listenersIsAdded=!0),timer.start();case 19:case"end":return e.stop()}},e,this)}));return function(n,t){return e.apply(this,arguments)}}();function _asyncToGenerator(e){return function(){var n=e.apply(this,arguments);return new Promise(function(e,t){return function r(a,o){try{var c=n[a](o),l=c.value}catch(e){return void t(e)}if(!c.done)return Promise.resolve(l).then(function(e){r("next",e)},function(e){r("throw",e)});e(l)}("next")})}}function loadChars(){var e={};function n(n){return function(t){return e[n]=t}}return Promise.all([loadUnicorn().then(n("unicorn")),loadEnemyBug().then(n("enemyBug")),loadRainbow().then(n("rainbow")),loadRocket().then(n("rocket")),loadArmor().then(n("armor"))]).then(function(){return e})}function createPlayerEnv(e){var n=new Entity("playerEnv"),t=new PlayerController;return t.checkpoint.set(64,64),t.setPlayer(e),t.cleanScore(),n.addTrait(t),e.fly.onChangeFlyingSec(),e.armor.onChangeArmor(),n}var context=null,charsFactory=null,loadLevel=null,level=null,camera=null,playerEnv=null,unicorn=null,timer=null,listenersIsAdded=!1,STATE="start",levelSelectInnerHTML="";function findAncestor(e,n){for(;(e=e.parentElement)&&!e.classList.contains(n););return e}Object.keys(LEVELS).forEach(function(e){levelSelectInnerHTML+='\n<li class="cards__item" data-level='+e+'>\n    <div class="card">\n        <div class="card__image" style="background-image: url('+LEVELS[e].previewImage+')"></div>\n        <div class="card__content">\n            <div class="card__title">'+LEVELS[e].title+"</div>\n        </div>\n    </div>\n</li>"}),document.getElementById("level-select").innerHTML=levelSelectInnerHTML,document.getElementById("level-select").addEventListener("click",function(e){var n=findAncestor(e.target,"cards__item");if(n){var t=n.getAttribute("data-level");document.getElementById("level-select-wrapper").classList.remove("show"),document.getElementById("screen").classList.remove("fade-in"),main(CANVAS,LEVELS[t])}});
"use strict";var _createClass=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var Matrix=function(){function t(){_classCallCheck(this,t),this.grid=[]}return _createClass(t,[{key:"get",value:function(t,e){var n=this.grid[t];if(n)return n[e]}},{key:"set",value:function(t,e,n){this.grid[t]||(this.grid[t]=[]),this.grid[t][e]=n}}]),t}(),Vec2=function(){function t(e,n){_classCallCheck(this,t),this.set(e,n)}return _createClass(t,[{key:"set",value:function(t,e){this.x=t,this.y=e}}]),t}();
"use strict";var _createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var ARMOR={imageURL:"img/armor.png",frames:[{name:"frame-1",rect:[0,0,50,50]}],animations:[{name:"anim",frameLen:.2,frames:["frame-1"]}]};function loadArmor(){return loadSpriteSheet(ARMOR).then(createArmorFactory)}var BehaviorArmor=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"behavior"))}return _inherits(t,Trait),_createClass(t,[{key:"collides",value:function(e,t){e.pickable.picked||(e.pickable.pick(),e.vel.set(30,-400),e.solid.obstructs=!1)}}]),t}();function createArmorFactory(e){var t=e.animations.get("anim");function r(r){e.draw(t(this.lifetime),r,0,0)}return function(){var e=new Entity("armor");return e.size.set(50,50),e.offset.y=20,e.addTrait(new Physics),e.addTrait(new Solid),e.addTrait(new Pickable),e.addTrait(new BehaviorArmor),e.draw=r,e}}
"use strict";var _createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var ENEMY_BUG={imageURL:"img/bug_line.png",frames:[{name:"frame-1",rect:[0,0,58,65]},{name:"frame-2",rect:[58,0,58,65]},{name:"frame-3",rect:[116,0,58,65]},{name:"frame-4",rect:[174,0,58,65]},{name:"frame-5",rect:[232,0,58,65]}],animations:[{name:"anim",frameLen:.2,frames:["frame-1","frame-2","frame-3","frame-4","frame-5"]}]};function loadEnemyBug(){return loadSpriteSheet(ENEMY_BUG).then(createEnemyBugFactory)}var BehaviorEnemyBug=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"behavior"))}return _inherits(t,Trait),_createClass(t,[{key:"collides",value:function(e,t){e.killable.dead||t.armor.collided||(t.armor.getCount()>0?t.armor.decrementCount():t.killable.kill())}}]),t}();function createEnemyBugFactory(e){var t=e.animations.get("anim");function r(r){e.draw(t(this.lifetime),r,0,0)}return function(){var e=new Entity("enemyBug");return e.size.set(58,45),e.offset.y=20,e.addTrait(new Physics),e.addTrait(new Solid),e.addTrait(new BehaviorEnemyBug),e.addTrait(new Killable),e.draw=r,e}}
"use strict";var _createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var RAINBOW={imageURL:"img/rainbow_line.png",frames:[{name:"spark-1",rect:[0,0,83,93]},{name:"spark-2",rect:[83,0,83,93]},{name:"spark-3",rect:[166,0,83,93]},{name:"spark-4",rect:[249,0,83,93]},{name:"spark-5",rect:[332,0,83,93]},{name:"spark-6",rect:[415,0,83,93]}],animations:[{name:"spark",frameLen:.2,frames:["spark-1","spark-2","spark-3","spark-4","spark-5","spark-6"]}]};function loadRainbow(){return loadSpriteSheet(RAINBOW).then(createRainbowFactory)}var BehaviorRainbow=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"behavior"))}return _inherits(t,Trait),_createClass(t,[{key:"collides",value:function(e,t){e.pickable.picked||(e.pickable.pick(),e.vel.set(30,-400),e.solid.obstructs=!1)}}]),t}();function createRainbowFactory(e){var t=e.animations.get("spark");function r(r){e.draw(t(this.lifetime),r,0,0,this.vel.x<0)}return function(){var e=new Entity("rainbow");return e.size.set(83,93),e.addTrait(new Physics),e.addTrait(new Solid),e.addTrait(new Pickable),e.addTrait(new BehaviorRainbow),e.draw=r,e}}
"use strict";var _createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var ROCKET={imageURL:"img/rocket.png",frames:[{name:"frame-1",rect:[0,0,58,65]}],animations:[{name:"anim",frameLen:.2,frames:["frame-1"]}]};function loadRocket(){return loadSpriteSheet(ROCKET).then(createRocketFactory)}var BehaviorRocket=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"behavior"))}return _inherits(t,Trait),_createClass(t,[{key:"collides",value:function(e,t){e.pickable.picked||(e.pickable.pick(),e.vel.set(30,-400),e.solid.obstructs=!1)}}]),t}();function createRocketFactory(e){var t=e.animations.get("anim");function r(r){e.draw(t(this.lifetime),r,0,0)}return function(){var e=new Entity("rocket");return e.size.set(58,45),e.offset.y=20,e.addTrait(new Physics),e.addTrait(new Solid),e.addTrait(new Pickable),e.addTrait(new BehaviorRocket),e.draw=r,e}}
"use strict";var UNICORN={imageURL:"img/unicorn_full.png",frames:[{name:"idle",rect:[0,0,172,119]},{name:"run-1",rect:[0,0,172,119]},{name:"run-2",rect:[173,0,172,119]},{name:"run-3",rect:[344,0,172,119]},{name:"run-4",rect:[517,0,172,119]},{name:"break",rect:[0,0,172,119]},{name:"jump",rect:[690,0,172,119]},{name:"death-1",rect:[0,120,172,119]},{name:"death-2",rect:[173,120,172,119]},{name:"death-3",rect:[344,120,172,119]},{name:"death-4",rect:[517,120,172,119]},{name:"death-5",rect:[690,120,172,119]},{name:"death-6",rect:[863,120,172,119]},{name:"death-7",rect:[1036,120,172,119]},{name:"death-8",rect:[1209,120,172,119]},{name:"death-9",rect:[1382,120,172,119]}],animations:[{name:"run",frameLen:20,frames:["run-1","run-2","run-3","run-4"]},{name:"death",frameLen:.2,frames:["death-5","death-6","death-7","death-8","death-9"]}]};function loadUnicorn(){return loadSpriteSheet(UNICORN).then(createUnicornFactory)}function createUnicornFactory(e){var a=e.animations.get("run"),n=e.animations.get("death");function r(r){var t;e.draw((t=this).killable.dead?n(t.lifetime):t.jump.falling?"jump":t.run.distance>0?a(t.run.distance):"idle",r,0,0,this.run.heading<0)}return function(){var e=new Entity("unicorn");return e.size.set(120,119),e.offset.x=20,e.addTrait(new Physics),e.addTrait(new Solid),e.addTrait(new Run),e.addTrait(new Jump),e.addTrait(new Fly),e.addTrait(new Armor),e.addTrait(new Picker),e.addTrait(new Killable),e.killable.removeAfter=1,e.draw=r,e}}